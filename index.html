<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kid Care Dashboard</title>
<style>
body {
font-family: -apple-system, BlinkMacSystemFont, sans-serif;
background:#f2f4f7;
padding:15px;
margin:0;
}
h2 { text-align:center; margin-bottom:20px; }
.kid {
background:white;
padding:15px;
margin-bottom:18px;
border-radius:14px;
box-shadow:0 4px 10px rgba(0,0,0,0.08);
}
.overdue { background:#ffe6e6; }
.nameInput {
font-size:20px;
font-weight:600;
border:none;
border-bottom:1px solid #ddd;
width:100%;
margin-bottom:10px;
}
.section {
margin-top:10px;
padding-top:8px;
border-top:1px solid #eee;
}
label { font-size:13px; color:#666; }
input[type="number"], input[type="text"] {
width:100%;
padding:6px;
margin:4px 0 6px 0;
font-size:16px;
}
.timer {
font-weight:bold;
font-size:16px;
margin-top:4px;
}
button {
padding:6px 8px;
margin-top:5px;
width:100%;
font-size:14px;
}
</style>
</head>
<body>

<h2>ðŸ‘¶ Kid Care Dashboard</h2>
<button onclick="enableNotifications()">Enable Notifications</button>

<div id="kids"></div>

<script>
const kidCount = 9;
let kids = [];
let notified = {};

// Enable notifications
function enableNotifications() {
if("Notification" in window) Notification.requestPermission();
}

// Save/load localStorage
function save() { localStorage.setItem("kidCareData", JSON.stringify(kids)); }
function load() { const data = localStorage.getItem("kidCareData"); if(data) kids = JSON.parse(data); }

// Initialize kids
function createKids() {
for(let i=0;i<kidCount;i++){
kids.push({
name:"Kid " + (i+1),
bottleInterval:3,
diaperInterval:2,
mealInterval:4,
lastBottle:null,
lastDiaper:null,
lastMeal:null
});
}
}

// Notify once per event
function notify(msg){
if(Notification.permission === "granted") new Notification(msg);
}

// Calculate next due time
function nextTime(last, interval){
if(!last) return null;
return last + interval*60*60*1000;
}

// Format countdown
function formatRemaining(ms){
if(ms<=0) return "OVERDUE";
const total = Math.floor(ms/1000);
const h = Math.floor(total/3600);
const m = Math.floor((total%3600)/60);
const s = total%60;
return `${h}h ${m}m ${s}s`;
}

// Convert HH:MM string to timestamp today
function parseTimeStr(str){
if(!str) return null;
const parts = str.split(":");
if(parts.length !== 2) return null;
const d = new Date();
d.setHours(Number(parts[0]));
d.setMinutes(Number(parts[1]));
d.setSeconds(0);
d.setMilliseconds(0);
return d.getTime();
}

// Convert timestamp to HH:MM
function formatTime(ts){
if(!ts) return "";
const d = new Date(ts);
const pad = n => n.toString().padStart(2,"0");
return `${pad(d.getHours())}:${pad(d.getMinutes())}`;
}

// Build section for each event
function buildEvent(index,type,label){
const kid = kids[index];
const interval = kid[type+"Interval"];
const last = kid["last"+type];
const due = nextTime(last,interval);
const now = Date.now();
const remaining = due ? due-now : null;

if(remaining !== null && remaining<=0 && !notified[type+index]){
notify(kid.name + " needs " + label);
notified[type+index] = true;
}

return `
<div class="section">
<label>${label} every (hours)</label>
<input type="number" value="${interval}" onchange="update(${index}, '${type}Interval', this.value)">
<label>Last ${label} (HH:MM)</label>
<input type="text" value="${formatTime(last)}" placeholder="14:30" onchange="setTime(${index}, 'last${type}', this.value)">
<div class="timer">${remaining !== null ? formatRemaining(remaining) : "Not set"}</div>
<button onclick="logNow(${index}, 'last${type}')">Log ${label} Now</button>
</div>
`;
}

// Render dashboard
function render(){
const container = document.getElementById("kids");
container.innerHTML = "";

kids.forEach((kid,index)=>{
const div = document.createElement("div");
div.className = "kid";

const overdue = ["Bottle","Diaper","Meal"].some(type=>{
const last = kid["last"+type];
const due = nextTime(last,kid[type+"Interval"]);
return due && Date.now()>due;
});
if(overdue) div.classList.add("overdue");

div.innerHTML = `
<input class="nameInput" value="${kid.name}" onchange="update(${index}, 'name', this.value)">
${buildEvent(index,"Bottle","Bottle")}
${buildEvent(index,"Diaper","Diaper")}
${buildEvent(index,"Meal","Meal")}
`;
container.appendChild(div);
});
save();
}

// Update field
function update(index,field,value){
if(field.includes("Interval")) kids[index][field] = Number(value);
else kids[index][field] = value;
save();
}

// Set time from HH:MM text
function setTime(index,field,value){
const ts = parseTimeStr(value);
if(ts===null) return;
kids[index][field] = ts;
notified[field+index] = false;
save();
render();
}

// Log now
function logNow(index,field){
kids[index][field] = Date.now();
notified[field+index] = false;
save();
render();
}

// Init
load();
if(kids.length===0) createKids();

render();   
setInterval(updateTimers,1000);
render();

function updateTimers(){
    const timerEls = document.querySelectorAll(".timer");

    kids.forEach((kid,index)=>{
        ["Bottle","Diaper","Meal"].forEach(type=>{
            const last = kid["last"+type];
            const interval = kid[type+"Interval"];
            const due = nextTime(last,interval);
            const remaining = due ? due-Date.now() : null;

            const timerIndex = index*3 + ["Bottle","Diaper","Meal"].indexOf(type);
            const el = timerEls[timerIndex];

            if(!el) return;

            if(remaining !== null){
                el.textContent = formatRemaining(remaining);
            }
        });
    });
}

</script>

</body>
</html>
